<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phoenix Project Client Bookings Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* Changed background to light grey */
            background-color: #f3f4f6; /* Tailwind gray-100 */
            min-height: 100vh;
        }
        .loading-spinner {
            /* Changed spinner color to orange */
            border: 4px solid #e5e7eb;
            border-top: 4px solid #f97316; /* Tailwind orange-500 */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Custom Red Box for Errors */
        #error-message {
            background-color: #fee2e2;
            border: 1px solid #f87171;
            color: #b91c1c;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-6xl mx-auto">
        
        <header class="mb-8 p-4 bg-white shadow-xl rounded-xl flex items-center">
            <img 
                src="https://static.wixstatic.com/media/cd24f5_912330da30e24a2d9d4dd70e6388de32~mv2.png/v1/fill/w_400,h_410,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/vectorstock_26862708_edited_edited.png"
                alt="Phoenix Projects Logo"
                class="w-16 h-16 mr-4 object-contain"
                onerror="this.onerror=null;this.src='https://placehold.co/64x64/f97316/ffffff?text=PP'"
            />
            <div>
                <h1 class="text-3xl font-extrabold text-gray-700 tracking-tight">
                    Phoenix Project: Next 14 Days Client Bookings
                </h1>
                <p class="text-gray-500 mt-1 text-sm">Targeting Calendar: <span id="calendar-id-display" class="font-semibold text-orange-600">Phoenix Project</span></p>
                <div id="full-calendar-id" class="hidden">16294fce896606f95d9542389f46416b12db7b95f70d8684b39c86128740f888@group.calendar.google.com</div>
            </div>
        </header>

        <nav class="mb-8 p-4 bg-orange-500 shadow-xl rounded-xl flex flex-wrap gap-4 justify-center">
            <a href="https://gemini.google.com/share/a74eb5643797" target="_blank" class="px-4 py-2 bg-white text-orange-500 font-semibold rounded-lg shadow-md hover:bg-gray-100 transition duration-150">
                Site Measure
            </a>
            <a href="https://gemini.google.com/share/f494c9321181" target="_blank" class="px-4 py-2 bg-white text-orange-500 font-semibold rounded-lg shadow-md hover:bg-gray-100 transition duration-150">
                Existing External Walls
            </a>
            <a href="Phoenix Ballpark Estimator.html" target="_blank" class="px-4 py-2 bg-white text-orange-500 font-semibold rounded-lg shadow-md hover:bg-gray-100 transition duration-150">
                Ballpark Estimate
            </a>
            <a href="design_assist.html" target="_blank" class="px-4 py-2 bg-white text-orange-500 font-semibold rounded-lg shadow-md hover:bg-gray-100 transition duration-150">
                Email Summary
            </a>
        </nav>
        <div id="error-message" class="hidden"></div>
        
        <div id="auth-status" class="bg-orange-100 border-l-4 border-orange-500 text-orange-800 p-4 rounded-lg mb-6 hidden">
            <p class="font-bold">Authorization Required</p>
            <p class="text-sm">Please click the button to authorize access to your Google Calendar and Tasks.</p>
            <button id="authorize-button" class="mt-3 px-4 py-2 bg-orange-500 text-white font-semibold rounded-lg shadow-md hover:bg-orange-700 transition duration-150">Authorize Access</button>
        </div>

        <div id="summary-card" class="bg-white p-4 rounded-xl shadow-lg mb-6 hidden">
            <h2 class="text-xl font-bold text-gray-700 mb-2">Bookings Summary</h2>
            <p class="text-gray-600 text-lg">You have <span id="booking-count" class="text-3xl font-extrabold text-orange-500 mr-1">0</span> upcoming client bookings in the next 14 days.</p>
        </div>
        
        <div id="main-content-grid" class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <div id="calendar-column" class="lg:col-span-2">
                <div id="loading" class="flex items-center justify-center p-10 bg-white rounded-xl shadow-lg mb-6">
                    <div class="loading-spinner mr-3"></div>
                    <p class="text-gray-600">Loading client bookings and tasks...</p>
                    <p id="debug-info" class="mt-4 text-xs text-gray-400"></p>
                </div>

                <div id="events-list" class="space-y-4">
                    </div>

                <div id="no-events" class="p-8 bg-white rounded-xl shadow-lg text-center text-gray-500 hidden">
                    <p class="font-semibold text-lg">No client bookings found in the next 14 days. Time for marketing!</p>
                    <p class="text-sm mt-2">The calendar being monitored is: <span id="no-events-calendar-id">Phoenix Project</span></p>
                </div>
            </div>

            <div id="tasks-column" class="lg:col-span-1">
                <div id="tasks-container" class="p-6 bg-white rounded-xl shadow-lg min-h-[300px]">
                    <h2 class="text-xl font-bold text-gray-700 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-orange-500" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16 4h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><path d="M22 6H16"/><path d="M12 4h.01"/><path d="M6 10h.01"/><path d="M6 14h.01"/><path d="M6 18h.01"/><path d="M16 10h4"/><path d="M16 14h4"/><path d="M16 18h4"/><path d="M3 6h1"/><path d="M3 10h1"/><path d="M3 14h1"/><path d="M3 18h1"/></svg>
                        <span id="task-list-title-display">All Pending Tasks</span>
                    </h2>
                    <div id="tasks-list" class="space-y-3">
                        <p class="text-gray-500 text-sm">Loading tasks...</p>
                    </div>
                </div>
            </div>

        </div> </div>

    <script src="https://accounts.google.com/gsi/client" async defer onload="gisOnLoad()"></script>
    
    <script src="https://apis.google.com/js/api.js" async defer onload="gapiOnLoad()"></script>
    
    <script>
        // --- CONFIGURATION ---
        // 1. OAuth Client ID: This is for user authentication (the pop-up).
        const CLIENT_ID = '234330216775-c4gdq3hshpqmviujm5lmdqnoufptpgdp.apps.googleusercontent.com'; 
        
        // 2. API Key: This is for server-side GAPI initialization.
        // *** YOU MUST REPLACE THE PLACEHOLDER BELOW WITH YOUR ACTUAL API KEY ***
        const API_KEY = 'AIzaSyAZADMHWu6Ev6JYrouZ4ZvL29epPUc0Q60'; 
        
        // 3. The ID of the Google Calendar to display.
        const CALENDAR_ID = '16294fce896606f95d9542389f46416b12db7b95f70d8684b39c86128740f888@group.calendar.google.com'; 
        
        // NOTE: TARGET_TASK_LIST_TITLE is no longer used, as we now fetch all tasks from all lists.

        const DISCOVERY_DOCS = [
            "https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest",
            "https://www.googleapis.com/discovery/v1/apis/tasks/v1/rest"
        ];
        
        // Scopes for reading both Calendar and Tasks
        const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly https://www.googleapis.com/auth/tasks.readonly'; 
        // -----------------------

        let tokenClient;
        let isClientInitialized = false;
        let isGapiReady = false;
        let isGisReady = false;

        const authStatusEl = document.getElementById('auth-status');
        const authorizeButton = document.getElementById('authorize-button');
        const loadingEl = document.getElementById('loading');
        const eventsListEl = document.getElementById('events-list');
        const noEventsEl = document.getElementById('no-events');
        const debugInfoEl = document.getElementById('debug-info');
        const errorMsgEl = document.getElementById('error-message');
        const bookingCountEl = document.getElementById('booking-count');
        const summaryCardEl = document.getElementById('summary-card');
        const tasksListEl = document.getElementById('tasks-list');
        const taskListTitleDisplay = document.getElementById('task-list-title-display');
        
        // Update display text for clarity
        document.getElementById('calendar-id-display').textContent = 'Phoenix Project';
        document.getElementById('no-events-calendar-id').textContent = 'Phoenix Project';

        // Display partial keys for debugging
        debugInfoEl.textContent = `Client ID: ${CLIENT_ID.substring(0, 10)}... | API Key: ${API_KEY.substring(0, 10)}...`;


        /**
         * Generic error display handler
         */
        const displayError = (title, message) => {
            loadingEl.classList.add('hidden');
            summaryCardEl.classList.add('hidden'); // Hide summary on error
            errorMsgEl.classList.remove('hidden');
            errorMsgEl.innerHTML = `<p class="font-bold">${title}</p><hr class="my-2 border-red-300"><p class="mt-1 text-sm">${message}</p>`;
            console.error(title, message);
            
            // Set Task list to error state too
            tasksListEl.innerHTML = `<p class="text-red-500 text-sm">Tasks failed to load due to authorization error.</p>`;
        };

        /**
         * Renders the event list using Tailwind for a clean look
         * @param {Array} events - The list of calendar events.
         * @param {number} totalBookings - The total count of events.
         */
        const renderEvents = (events, totalBookings) => {
            eventsListEl.innerHTML = '';
            
            // 1. Update Summary Card with total count
            bookingCountEl.textContent = totalBookings;
            summaryCardEl.classList.remove('hidden');

            if (events.length === 0) {
                noEventsEl.classList.remove('hidden');
                loadingEl.classList.add('hidden');
                return;
            }

            const eventsByDate = events.reduce((acc, event) => {
                const dateKey = new Date(event.start.dateTime || event.start.date).toLocaleDateString();
                if (!acc[dateKey]) {
                    acc[dateKey] = [];
                }
                acc[dateKey].push(event);
                return acc;
            }, {});

            for (const dateKey in eventsByDate) {
                const dayEvents = eventsByDate[dateKey];
                
                const header = document.createElement('h3');
                header.className = 'text-xl font-bold text-gray-700 mt-6 mb-2 border-b-2 border-orange-300 pb-1';
                header.textContent = new Date(dayEvents[0].start.dateTime || dayEvents[0].start.date).toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                eventsListEl.appendChild(header);

                dayEvents.forEach(event => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = 'flex bg-white rounded-xl shadow-md p-4 transition-all hover:shadow-lg';
                    
                    const startDateTime = event.start.dateTime || event.start.date;
                    const isAllDay = !event.start.dateTime;

                    const dateDisplay = document.createElement('div');
                    dateDisplay.className = 'flex-shrink-0 w-24 text-center mr-4 p-2 bg-orange-50 text-orange-700 rounded-lg font-semibold';
                    
                    const formatDate = (isoDate) => {
                        try {
                            const date = new Date(isoDate);
                            const options = { hour: '2-digit', minute: '2-digit', hour12: true };
                            return date.toLocaleTimeString('en-US', options); 
                        } catch (e) {
                            return isoDate;
                        }
                    };

                    if (isAllDay) {
                         dateDisplay.innerHTML = `<span class="block text-xs">All Day</span>`;
                    } else {
                        const timeString = formatDate(startDateTime);
                        // Safely extract time and AM/PM
                        const timeParts = timeString.match(/(\d{1,2}:\d{2})\s*(AM|PM)/i);
                        const time = timeParts ? `${timeParts[1]}` : timeString;
                        const ampm = timeParts ? timeParts[2] : '';
                        dateDisplay.innerHTML = `<span class="block text-xl">${time}</span><span class="block text-xs uppercase">${ampm}</span>`;
                    }
                    
                    const detailsDiv = document.createElement('div');
                    detailsDiv.className = 'flex-grow';
                    detailsDiv.innerHTML = `
                        <p class="text-lg font-semibold text-gray-700">${event.summary || 'No Title'}</p>
                        ${event.location ? `<p class="text-sm text-gray-500 flex items-center mt-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-orange-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="2.5"/></svg>
                            ${event.location}
                        </p>` : ''}
                        
                        ${event.description ? `<p class="text-sm text-gray-700 mt-2 p-3 bg-gray-50 rounded-lg whitespace-pre-wrap border border-gray-200">
                            <span class="font-bold text-gray-600">Notes:</span> ${event.description}
                        </p>` : ''}
                    `;
                    
                    eventDiv.appendChild(dateDisplay);
                    eventDiv.appendChild(detailsDiv);
                    eventsListEl.appendChild(eventDiv);
                });
            }

            loadingEl.classList.add('hidden');
        };

        /**
         * Renders the task list.
         * @param {Array<Object>} tasks - An array of tasks, now including the list title property.
         */
        const renderTasks = (tasks) => {
            tasksListEl.innerHTML = '';

            if (tasks.length === 0) {
                tasksListEl.innerHTML = `<p class="text-gray-500 text-sm">ðŸŽ‰ No pending tasks across all your lists.</p>`;
                return;
            }

            // Sort tasks: Due dates first (earliest), then tasks without due dates, finally by list title
            tasks.sort((a, b) => {
                const dueA = a.due ? new Date(a.due).getTime() : Infinity;
                const dueB = b.due ? new Date(b.due).getTime() : Infinity;
                
                // Primary sort: Due date
                if (dueA !== dueB) {
                    return dueA - dueB;
                }
                
                // Secondary sort: List title
                return a.listTitle.localeCompare(b.listTitle);
            });

            // Group tasks by list title for better visual organization
            const tasksByList = tasks.reduce((acc, task) => {
                if (!acc[task.listTitle]) {
                    acc[task.listTitle] = [];
                }
                acc[task.listTitle].push(task);
                return acc;
            }, {});

            for (const listTitle in tasksByList) {
                // Add list header
                const listHeader = document.createElement('h4');
                listHeader.className = 'text-base font-bold text-orange-600 mt-4 mb-2 border-b border-orange-200 pb-1';
                listHeader.textContent = listTitle;
                tasksListEl.appendChild(listHeader);

                tasksByList[listTitle].forEach(task => {
                    const taskItem = document.createElement('div');
                    let dueDisplay = 'No Due Date';
                    let dueClass = 'text-gray-500';
                    let descriptionDisplay = '';

                    if (task.due) {
                        const dueDate = new Date(task.due);
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        const dueDay = new Date(dueDate.getFullYear(), dueDate.getMonth(), dueDate.getDate());

                        if (dueDay.getTime() < today.getTime()) {
                            dueDisplay = 'Overdue: ' + dueDate.toLocaleDateString();
                            dueClass = 'text-red-500 font-semibold';
                        } else if (dueDay.getTime() === today.getTime()) {
                            dueDisplay = 'Due Today!';
                            dueClass = 'text-orange-600 font-bold';
                        } else {
                            dueDisplay = 'Due: ' + dueDate.toLocaleDateString();
                            dueClass = 'text-gray-500';
                        }
                    }
                    
                    if (task.notes) {
                        const maxLength = 60;
                        const truncatedNotes = task.notes.length > maxLength 
                            ? task.notes.substring(0, maxLength).trim() + '...' 
                            : task.notes;
                        descriptionDisplay = `<p class="text-xs text-gray-400 mt-1">${truncatedNotes}</p>`;
                    }

                    taskItem.className = 'border-b border-gray-100 pb-2 mb-2';
                    taskItem.innerHTML = `
                        <p class="font-medium text-sm text-gray-700">${task.title}</p>
                        ${descriptionDisplay}
                        <p class="text-xs ${dueClass}">${dueDisplay}</p>
                    `;
                    tasksListEl.appendChild(taskItem);
                });
            }
        };

        /**
         * Fetches all non-completed tasks from ALL of the user's task lists.
         */
        const loadTasks = async () => {
            tasksListEl.innerHTML = '<p class="text-gray-500 text-sm">Fetching all task lists...</p>';
            let allTasks = [];
            
            try {
                // 1. Get ALL Task Lists
                const listsResponse = await gapi.client.tasks.tasklists.list({
                    'maxResults': 100 // Get up to 100 lists
                });

                const taskLists = listsResponse.result.items || [];

                if (taskLists.length === 0) {
                    tasksListEl.innerHTML = `<p class="text-gray-500 text-sm">No Google Task lists found in your account.</p>`;
                    return;
                }

                // 2. Fetch Tasks from EACH list concurrently
                const fetchPromises = taskLists.map(list => {
                    return gapi.client.tasks.tasks.list({
                        'tasklist': list.id,
                        'showCompleted': false,
                        'maxResults': 100 // Get up to 100 tasks per list
                    }).then(tasksResponse => {
                        const tasks = tasksResponse.result.items || [];
                        // Attach the list title to each task for rendering/grouping later
                        return tasks.map(task => ({ ...task, listTitle: list.title }));
                    }).catch(error => {
                        // Log errors for individual lists but continue fetching others
                        console.warn(`Could not fetch tasks for list: ${list.title}`, error);
                        return [];
                    });
                });

                // Wait for all fetches to complete
                const results = await Promise.all(fetchPromises);
                
                // Flatten the array of task arrays into a single array
                allTasks = results.flat();
                
                // 3. Render the combined, sorted task list
                renderTasks(allTasks);

            } catch (error) {
                // If the error happens during the API call (e.g., failed to list tasklists), report it.
                tasksListEl.innerHTML = `<p class="text-red-500 text-sm">Error loading tasks. Check permissions. Details: ${error.message || 'Unknown error.'}</p>`;
                console.error("Task Loading Error:", error);
            }
        };


        /**
         * Fetches and lists the next 14 days of events, and then loads tasks.
         */
        const listEvents = async () => {
            loadingEl.classList.remove('hidden');
            eventsListEl.innerHTML = '';
            noEventsEl.classList.add('hidden');
            errorMsgEl.classList.add('hidden');
            authStatusEl.classList.add('hidden');


            try {
                const now = new Date();
                const fourteenDaysFromNow = new Date();
                fourteenDaysFromNow.setDate(now.getDate() + 14);

                // 1. Fetch Calendar Events
                const response = await gapi.client.calendar.events.list({
                    'calendarId': CALENDAR_ID,
                    'timeMin': now.toISOString(),
                    'timeMax': fourteenDaysFromNow.toISOString(),
                    'showDeleted': false,
                    'singleEvents': true,
                    'maxResults': 50,
                    'orderBy': 'startTime'
                });

                const events = response.result.items || [];
                const totalBookings = events.length;

                renderEvents(events, totalBookings);

                // 2. Load Tasks
                // This will run only if gapi.client is properly initialized
                loadTasks(); 

            } catch (error) {
                // Ensure error message is extracted correctly
                const message = error.result?.error?.message || error.body || error.message || "Unknown Error. Check Console for details.";
                displayError("Error Listing Events!", `Authorization succeeded, but the request failed. Details: ${message}. Make sure the Calendar ID is correct and the calendar is shared with the authorized email.`);
            }
        };

        /**
         * Handles the click event for the authorization button.
         */
        const handleAuthClick = () => {
            if (tokenClient) {
                authStatusEl.classList.add('hidden');
                loadingEl.classList.remove('hidden');
                // Request access token (this will trigger the pop-up if needed)
                tokenClient.requestAccessToken({ prompt: 'consent' }); // Request user consent interactively
            } else {
                displayError("System Error", "Token client not initialized. Try refreshing the page.");
            }
        };
        
        /**
         * Main initialization function that runs when GAPI client and GIS are confirmed ready.
         */
        const initClient = async () => {
            if (isClientInitialized) return;
            isClientInitialized = true; // Set immediately to prevent multiple runs

            // Check if the developer placeholders are still set
            if (API_KEY.includes('YOUR_API_KEY')) {
                 displayError(
                    "Configuration Required", 
                    "You must replace the placeholder value for API_KEY in the JavaScript code with your actual credentials from Google Cloud Console."
                );
                isClientInitialized = false;
                return;
            }

            try {
                // 1. Initialize the GAPI client for API calls
                await new Promise(resolve => setTimeout(resolve, 100)); 
                
                await gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: DISCOVERY_DOCS,
                });
                
                // 2. Setup the Token Client for OAuth 2.0 flow
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    // IMPORTANT: The prompt parameter set to 'none' handles the non-interactive/silent sign-in.
                    prompt: '', 
                    callback: (tokenResponse) => {
                        if (tokenResponse && tokenResponse.access_token) {
                            gapi.client.setToken(tokenResponse);
                            authStatusEl.classList.add('hidden');
                            listEvents(); // Triggers both calendar and tasks loading
                        } else {
                            // If silent sign-in fails, switch to interactive mode.
                            console.warn('Silent authorization failed. Switching to interactive mode.');
                            // Re-initiate request access token, allowing pop-up this time
                            tokenClient.callback = (interactiveTokenResponse) => {
                                if (interactiveTokenResponse && interactiveTokenResponse.access_token) {
                                    gapi.client.setToken(interactiveTokenResponse);
                                    listEvents();
                                } else {
                                    console.error('Interactive authorization failed.');
                                    loadingEl.classList.add('hidden');
                                    summaryCardEl.classList.add('hidden');
                                    authStatusEl.classList.remove('hidden');
                                }
                            };
                            tokenClient.requestAccessToken({ prompt: 'consent' }); // Request user consent interactively
                        }
                    },
                });
                
                // Try silent authorization first on load
                tokenClient.requestAccessToken();


                authorizeButton.onclick = handleAuthClick;
                
                // We initially show loading while silent auth attempts.
                loadingEl.classList.remove('hidden');
                authStatusEl.classList.add('hidden');

            } catch (error) {
                isClientInitialized = false; // Allow re-initialization if needed
                const message = error.result?.error?.message || error.message || "Unknown GAPI Init Error. This often means the API Key is invalid or restricted.";
                displayError("GAPI Client Initialization Error!", `This means your API Key or project settings are incorrect. Details: ${message}. Please check your API Key (currently showing ${API_KEY.substring(0, 10)}...) in the Google Cloud Console.`);
            }
        };

        // --- GLOBAL CALLBACKS REQUIRED BY GOOGLE SCRIPTS ---
        
        function tryInitClient() {
            if (isGapiReady && isGisReady) {
                initClient();
            }
        }
        
        function gapiOnLoad() {
            gapi.load('client', () => {
                isGapiReady = true;
                tryInitClient();
            });
        }
        
        function gisOnLoad() {
            isGisReady = true;
            tryInitClient();
        }

        // Expose callbacks globally (required by Google scripts)
        window.gapiOnLoad = gapiOnLoad;
        window.gisOnLoad = gisOnLoad;

        // Fallback check in case the callbacks missed
        window.onload = () => {
            setTimeout(() => {
                if (!isClientInitialized) {
                    const isGapiAvailable = (typeof gapi !== 'undefined');
                    const isGisAvailable = (typeof google !== 'undefined' && typeof google.accounts !== 'undefined');
                     
                    if (isGapiAvailable && isGisAvailable) {
                        if (!isGapiReady) {
                             gapi.load('client', () => {
                                isGapiReady = true;
                                tryInitClient();
                            });
                        }
                        if (!isGisReady) {
                            isGisReady = true; 
                        }
                        tryInitClient();

                    } else {
                        displayError(
                            "Library Loading Timeout", 
                            "Failed to load Google Identity Services (GIS) or GAPI client libraries. Check your network connection or if a strict Content Security Policy is blocking external scripts."
                        );
                    }
                }
            }, 5000); // Wait 5 seconds before declaring timeout
        };
    </script>
</body>
</html>
